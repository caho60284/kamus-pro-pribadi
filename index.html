<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Vocab Ultra</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
body{margin:0;background:#f5f7fb}

header{
position:sticky;top:0;background:#fff;padding:16px;
box-shadow:0 2px 6px rgba(0,0,0,.08);z-index:10
}

h1{margin:0;font-size:22px}
.count{font-size:14px;color:#666;margin-top:4px}

.controls{
display:flex;gap:10px;margin-top:10px;flex-wrap:wrap
}

button{
border:none;padding:10px 14px;border-radius:10px;
font-size:14px;color:#fff;cursor:pointer
}

.import{background:#1e88e5}
.export{background:#6a5acd}
.deleteall{background:#e53935}
.favbtn{background:#f39c12}
.refresh{background:#27ae60}
.add{background:#e3f2fd;color:#000}

.search{
width:100%;margin-top:10px;padding:12px;
border-radius:10px;border:1px solid #ccc;
font-size:16px
}

main{padding:16px}

.card{
background:#fff;border-radius:14px;padding:14px;
margin-bottom:12px;
display:flex;justify-content:space-between;
align-items:flex-start
}

.word{font-weight:700;font-size:18px}
.pron{color:#555;margin-top:2px}
.meaning{
color:#444;margin-top:4px;
white-space:normal;      /* ‚úÖ FIX meaning wrap */
word-break:break-word
}

.icons span{
font-size:20px;margin-right:6px;cursor:pointer
}

.star{
font-size:22px;cursor:pointer
}

.star.on{color:#f5b301}
.star.off{color:#ccc}

.modal{
position:fixed;inset:0;background:rgba(0,0,0,.4);
display:none;align-items:center;justify-content:center;
z-index:99
}

.modal-content{
background:#fff;width:92%;max-width:420px;
padding:16px;border-radius:14px;
max-height:90vh;overflow:auto
}

.modal-content input{
width:100%;margin-bottom:8px;padding:10px;
border-radius:8px;border:1px solid #ccc
}

.row{display:flex;gap:8px;margin-top:8px}
.green{background:#2ecc71;color:#fff;flex:1}
.blue{background:#1e88e5;color:#fff;flex:1}
.red{background:#e53935;color:#fff;flex:1}
.gray{background:#bbb;color:#fff;flex:1}
</style>
</head>

<body>

<header>
<h1>üìò My Vocab Ultra</h1>
<div class="count" id="count">Total vocabulary: 0 words</div>

<div class="controls">
<button class="import" onclick="importCSV()">üì• Import</button>
<button class="export" onclick="exportCSV()">üì§ Export</button>
<button class="deleteall" onclick="deleteAll()">üß® Delete All</button>
<button class="favbtn" onclick="showFav()">‚≠ê Favorites</button>
<button class="refresh" onclick="resetView()">üîÑ</button>
<button class="add" onclick="openModal()">Ôºã</button>
</div>

<input class="search" id="search" placeholder="Search word or meaning..." oninput="render()">
</header>

<main id="list"></main>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-content">

<input id="word" placeholder="Word">
<input id="pron" placeholder="Pronunciation">
<input id="meaning" placeholder="Meaning">

<input id="ex1" placeholder="Example 1">
<input id="ipa1" placeholder="IPA Example 1">
<input id="tr1" placeholder="Translation 1">

<input id="ex2" placeholder="Example 2">
<input id="ipa2" placeholder="IPA Example 2">
<input id="tr2" placeholder="Translation 2">

<div class="row">
<button class="green" onclick="speakEx1()">üîä Ex1</button>
<button class="green" onclick="speakEx2()">üîä Ex2</button>
</div>

<div class="row">
<button class="blue" onclick="save()">Save</button>
<button class="red" onclick="remove()">Delete</button>
<button class="gray" onclick="closeModal()">Cancel</button>
</div>

</div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("vocabUltra")||"[]")
let editIndex=null
let showOnlyFav=false

function render(){
const list=document.getElementById("list")
list.innerHTML=""

const q=document.getElementById("search").value.toLowerCase()

let filtered=data.filter(v=>{
if(showOnlyFav && !v.fav) return false
return (
v.word?.toLowerCase().includes(q) ||
v.meaning?.toLowerCase().includes(q)
)
})

document.getElementById("count").innerText=`Total vocabulary: ${filtered.length} words`

filtered.forEach(v=>{
const i=data.indexOf(v)

const d=document.createElement("div")
d.className="card"

d.innerHTML=`
<div>
<div class="word">${v.word||""}</div>
<div class="pron">${v.pron||""}</div>
<div class="meaning">${v.meaning||""}</div>
<div class="icons">
<span onclick="playWord('${v.word}')">üîä</span>
<span onclick="playSlow('${v.word}')">üê¢</span>
<span onclick="edit(${i})">‚úèÔ∏è</span>
</div>
</div>

<div>
<span class="star ${v.fav?'on':'off'}" onclick="toggleFav(${i})">‚òÖ</span>
</div>
`
list.appendChild(d)
})

localStorage.setItem("vocabUltra",JSON.stringify(data))
}

function toggleFav(i){
data[i].fav=!data[i].fav
render()
}

function showFav(){
showOnlyFav=true
render()
}

function resetView(){
showOnlyFav=false
document.getElementById("search").value=""
render()
}

function openModal(){
editIndex=null
word.value=pron.value=meaning.value=""
ex1.value=ipa1.value=tr1.value=""
ex2.value=ipa2.value=tr2.value=""
modal.style.display="flex"
}

function edit(i){
editIndex=i
const v=data[i]

word.value=v.word||""
pron.value=v.pron||""
meaning.value=v.meaning||""

ex1.value=v.ex1||""
ipa1.value=v.ipa1||""
tr1.value=v.tr1||""

ex2.value=v.ex2||""
ipa2.value=v.ipa2||""
tr2.value=v.tr2||""

modal.style.display="flex"
}

function save(){
const v={
word:word.value,
pron:pron.value,
meaning:meaning.value,
ex1:ex1.value,
ipa1:ipa1.value,
tr1:tr1.value,
ex2:ex2.value,
ipa2:ipa2.value,
tr2:tr2.value,
fav: editIndex!==null ? data[editIndex].fav : false
}

if(editIndex===null) data.push(v)
else data[editIndex]=v

closeModal()
render()
}

function remove(){
if(editIndex!==null){
data.splice(editIndex,1)
closeModal()
render()
}
}

function deleteAll(){
if(confirm("Delete all vocabulary?")){
data=[]
render()
}
}

function closeModal(){
modal.style.display="none"
}

function playWord(t){
speechSynthesis.speak(new SpeechSynthesisUtterance(t))
}

function playSlow(t){
let u=new SpeechSynthesisUtterance(t)
u.rate=0.6
speechSynthesis.speak(u)
}

function speakEx1(){
if(ex1.value) speechSynthesis.speak(new SpeechSynthesisUtterance(ex1.value))
}

function speakEx2(){
if(ex2.value) speechSynthesis.speak(new SpeechSynthesisUtterance(ex2.value))
}

function exportCSV(){
let csv="word,pronunciation,meaning,example1,ipa1,translation1,example2,ipa2,translation2,favorite\n"
data.forEach(v=>{
csv+=`"${v.word||""}","${v.pron||""}","${v.meaning||""}","${v.ex1||""}","${v.ipa1||""}","${v.tr1||""}","${v.ex2||""}","${v.ipa2||""}","${v.tr2||""}","${v.fav?1:0}"\n`
})

const a=document.createElement("a")
a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}))
a.download="my-vocab-ultra.csv"
a.click()
}

function importCSV(){
const i=document.createElement("input")
i.type="file"
i.accept=".csv"
i.onchange=e=>{
const r=new FileReader()
r.onload=()=>{
const lines=r.result.split(/\r?\n/).filter(l=>l.trim())
data=[]

lines.forEach((line,idx)=>{
if(idx===0) return
const c=line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)
if(!c) return

data.push({
word:c[0]?.replace(/"/g,""),
pron:c[1]?.replace(/"/g,""),
meaning:c[2]?.replace(/"/g,""),
ex1:c[3]?.replace(/"/g,""),
ipa1:c[4]?.replace(/"/g,""),
tr1:c[5]?.replace(/"/g,""),
ex2:c[6]?.replace(/"/g,""),
ipa2:c[7]?.replace(/"/g,""),
tr2:c[8]?.replace(/"/g,""),
fav:c[9]==="1"
})
})

render()
alert("Import success")
}
r.readAsText(e.target.files[0])
}
i.click()
}

render()
</script>
</body>
</html>
